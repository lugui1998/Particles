!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";exports.byteLength=function(b64){var b64=getLens(b64),validLen=b64[0],b64=b64[1];return 3*(validLen+b64)/4-b64},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],lens=lens[1],arr=new Arr(function(validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(validLen,lens)),curByte=0,len=0<lens?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===lens&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(function(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(function(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}(tmp));return output.join("")}(uint8,i,len2<i+16383?len2:i+16383));1==extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2==extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"="));return parts.join("")};for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(0<len%4)throw new Error("Invalid string. Length must be a multiple of 4");b64=b64.indexOf("="),len=(b64=-1===b64?len:b64)===len?0:4-b64%4;return[b64,len]}revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],2:[function(require,module,exports){!function(Buffer){!function(){"use strict";var base64=require("base64-js"),ieee754=require("ieee754"),K_MAX_LENGTH=(exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50,2147483647);function createBuffer(length){if(K_MAX_LENGTH<length)throw new RangeError('The value "'+length+'" is invalid for option "size"');length=new Uint8Array(length);return length.__proto__=Buffer.prototype,length}function Buffer(arg,encodingOrOffset,length){if("number"!=typeof arg)return from(arg,encodingOrOffset,length);if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}function from(value,encodingOrOffset,length){if("string"==typeof value)return function(string,encoding){"string"==typeof encoding&&""!==encoding||(encoding="utf8");if(!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),string=buf.write(string,encoding);string!==length&&(buf=buf.slice(0,string));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return function(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);return array.__proto__=Buffer.prototype,array}(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);valueOf=function(obj){{var len,buf;if(Buffer.isBuffer(obj))return len=0|checked(obj.length),0===(buf=createBuffer(len)).length||obj.copy(buf,0,0,len),buf}if(void 0!==obj.length)return"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if("Buffer"===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(valueOf)return valueOf;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(K_MAX_LENGTH<=length)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=2<arguments.length&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((start=void 0===start||start<0?0:start)>this.length)return"";if((end=void 0===end||end>this.length?this.length:end)<=0)return"";if((end>>>=0)<=(start>>>=0))return"";for(encoding=encoding||"utf8";;)switch(encoding){case"hex":return function(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0);(!end||end<0||len<end)&&(end=len);for(var out="",i=start;i<end;++i)out+=function(n){return n<16?"0"+n.toString(16):n.toString(16)}(buf[i]);return out}(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}(this,start,end);case"latin1":case"binary":return function(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}(this,start,end);case"base64":return function(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):2147483647<byteOffset?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),(byteOffset=(byteOffset=numberIsNaN(byteOffset=+byteOffset)?dir?0:buffer.length-1:byteOffset)<0?buffer.length+byteOffset:byteOffset)>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?(dir?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;arrLength/=indexSize=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir)for(var foundIndex=-1,i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(i-(foundIndex=-1===foundIndex?i:foundIndex)+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1;else for(i=byteOffset=arrLength<byteOffset+valLength?arrLength-valLength:byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var hi,c,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,c=c%256,byteArray.push(c),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&127<(tempCodePoint=(31&firstByte)<<6|63&secondByte)&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&2047<(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)&&(tempCodePoint<55296||57343<tempCodePoint)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&65535<(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):65535<codePoint&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="",i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,(Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=from,Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return assertSize(size),!(size<=0)&&void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)},Buffer.allocUnsafe=allocUnsafe,Buffer.allocUnsafeSlow=allocUnsafe,Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);if(void 0===length)for(i=length=0;i<list.length;++i)length+=list[i].length;for(var buffer=Buffer.allocUnsafe(length),pos=0,i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toLocaleString=Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(Buffer.isBuffer(b))return this===b||0===Buffer.compare(this,b);throw new TypeError("Argument must be a Buffer")},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES,str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();return this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),(start=void 0===start?0:start)<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisEnd<=thisStart&&end<=start)return 0;if(thisEnd<=thisStart)return-1;if(end<=start)return 1;if(this===target)return 0;for(var x=(thisEnd>>>=0)-(thisStart>>>=0),y=(end>>>=0)-(start>>>=0),len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||remaining<length)&&(length=remaining),0<string.length&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding=encoding||"utf8";for(var loweredCase=!1;;)switch(encoding){case"hex":return function(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;(!length||remaining<(length=Number(length)))&&(length=remaining),(remaining=string.length)/2<length&&(length=remaining/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}(this,string,offset,length);case"utf8":case"utf-8":return function(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return asciiWrite(this,string,offset,length);case"base64":return function(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(length<offset+ext)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(max<value||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var len=this.length,len=((start=~~start)<0?(start+=len)<0&&(start=0):len<start&&(start=len),(end=void 0===end?len:~~end)<0?(end+=len)<0&&(end=0):len<end&&(end=len),end<start&&(end=start),this.subarray(start,end));return len.__proto__=Buffer.prototype,len},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;0<byteLength&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];0<i&&(mul*=256);)val+=this[offset+--i]*mul;return(mul*=128)<=val&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset]|this[offset+1]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);noAssert=this[offset+1]|this[offset]<<8;return 32768&noAssert?4294901760|noAssert:noAssert},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,byteLength>>>=0,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,byteLength,(noAssert=Math.pow(2,8*byteLength-1))-1,-noAssert);var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;0<=--i&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),this[offset]=255&(value=value<0?255+value+1:value),offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=(value=value<0?4294967295+value+1:value)>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start=start||0,end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),(end=0<end&&end<start?start:end)===start)return 0;if(0===target.length||0===this.length)return 0;if((targetStart=targetStart||0)<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length);var len=(end=target.length-targetStart<end-start?target.length-targetStart+start:end)-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;0<=i;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var code;1===val.length&&(code=val.charCodeAt(0),("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code))}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,"number"==typeof(val=val||0))for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if(55295<(codePoint=string.charCodeAt(i))&&codePoint<57344){if(!leadSurrogate){if(56319<codePoint){-1<(units-=3)&&bytes.push(239,191,189);continue}if(i+1===length){-1<(units-=3)&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){-1<(units-=3)&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&-1<(units-=3)&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if(--units<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=(str=str.split("=")[0]).trim().replace(INVALID_BASE64_RE,"")).length<2)return"";for(;str.length%4!=0;)str+="=";return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}.call(this)}.call(this,require("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:3}],3:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,nBytes=buffer[offset+i];for(i+=d,e=nBytes&(1<<-nBits)-1,nBytes>>=-nBits,nBits+=eLen;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(nBytes?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(nBytes?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,nBytes=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(isLE=Math.pow(2,-e))<1&&(e--,isLE*=2),2<=(value+=1<=e+eBias?rt/isLE:rt*Math.pow(2,1-eBias))*isLE&&(e++,isLE/=2),eMax<=e+eBias?(m=0,e=eMax):1<=e+eBias?(m=(value*isLE-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*nBytes}},{}],4:[function(require,module,exports){class Particles{static Air=0;static Dust=1;static Stone=2;static Water=3;static Metal=4;static Rust=5;static Lava=6;static Void=7;static Fire=8;static Steam=9;static getId(name){return Particles[name]}static isFluid(id){return[Particles.Water,Particles.Lava,Particles.Steam].includes(id)}static isHidden(id){return[Particles.Rust,Particles.Steam].includes(id)}}const Names=[],Colors=(Names[Particles.Air]="Air",Names[Particles.Dust]="Dust",Names[Particles.Stone]="Stone",Names[Particles.Water]="Water",Names[Particles.Metal]="Metal",Names[Particles.Rust]="Rust",Names[Particles.Lava]="Lava",Names[Particles.Void]="Void",Names[Particles.Fire]="Fire",Names[Particles.Steam]="Steam",[]),Density=(Colors[Particles.Air]=[20,20,20],Colors[Particles.Dust]=[242,189,107],Colors[Particles.Stone]=[128,128,128],Colors[Particles.Water]=[64,64,255],Colors[Particles.Metal]=[64,64,64],Colors[Particles.Rust]=[121,79,58],Colors[Particles.Lava]=[255,102,51],Colors[Particles.Void]=[0,0,0],Colors[Particles.Fire]=[255,50,50],Colors[Particles.Steam]=[204,204,204],[]),InitialState=(Density[Particles.Air]=.05,Density[Particles.Dust]=.4,Density[Particles.Stone]=.8,Density[Particles.Water]=.1,Density[Particles.Rust]=Density[Particles.Dust],Density[Particles.Lava]=.6,Density[Particles.Fire]=0,Density[Particles.Steam]=.07,[]);InitialState[Particles.Air]=[Particles.Air,0,0,0],InitialState[Particles.Dust]=[Particles.Dust,5,0,0],InitialState[Particles.Stone]=[Particles.Stone,0,0,0],InitialState[Particles.Water]=[Particles.Water,0,30,0],InitialState[Particles.Metal]=[Particles.Metal,0,0,0],InitialState[Particles.Rust]=[Particles.Rust,0,0,0],InitialState[Particles.Lava]=[Particles.Lava,0,0,0],InitialState[Particles.Void]=[Particles.Void,0,0,0],InitialState[Particles.Fire]=[Particles.Fire,0,0,0],InitialState[Particles.Steam]=[Particles.Steam,0,90,0],module.exports={Particles:Particles,Names:Names,Colors:Colors,Density:Density,InitialState:InitialState}},{}],5:[function(require,module,exports){!function(Buffer){!function(){const Tile=require("./Tile"),{Particles,Names,InitialState,Colors}=require("./Particles/Particles"),Random=require("./Utils/Random"),QuickBits=require("./Utils/QuickBits");module.exports=class{width=0;height=0;tileGridSize=0;physicsStartTime=0;lastFramesTimes=[];sharedBuffer=null;tiles=[];mousePrevPos={};mousePos={x:0,y:0};leftMousePressed=!1;rightMousePressed=!1;sandboxArea=null;grid=null;brush0=Particles.Dust;brush1=Particles.Air;brushSize=1;canvas;pauseState=!1;constructor(sandboxArea,tileGridSize=[4,2]){this.width=sandboxArea.offsetWidth,this.height=sandboxArea.offsetHeight,this.tileGridSize=tileGridSize,this.sandboxArea=sandboxArea,this.sharedBuffer=new SharedArrayBuffer(this.width*this.height*2*4),this.grid=new Int16Array(this.sharedBuffer);var tileWidth=Math.ceil(this.width/this.tileGridSize[0]),tileHeight=Math.ceil(this.height/this.tileGridSize[1]);let tileIndex=0,x=0;do{let endX=x+tileWidth,y=0;do{let endY=y+tileHeight;endX>this.width&&(endX=this.width),endY>this.height&&(endY=this.height),console.log(`Creating tile at [${x} ${y}] to [${endX} ${endY}] size [${endX-x} ${endY-y}]`),this.canvas=document.createElement("canvas"),this.canvas.width=endX-x,this.canvas.height=endY-y,this.canvas.style.position="absolute",this.canvas.style.left=x+"px",this.canvas.style.top=y+"px",sandboxArea.appendChild(this.canvas),this.tiles.push(new Tile(tileIndex++,this.canvas,this.sharedBuffer,x,y,endX,endY,4,this.width,this.height)),y=endY}while(y<this.height);x=endX}while(x<this.width);this.sandboxArea.oncontextmenu=e=>{e.preventDefault()},this.sandboxArea.onmousemove=this.HandleOnMouseMove.bind(this),this.sandboxArea.onmousedown=this.HandleOnMouseDown.bind(this),this.sandboxArea.onmouseup=this.HandleOnMouseUp.bind(this),this.sandboxArea.onmouseenter=this.HandleOnMouseEnter.bind(this),this.sandboxArea.onmouseleave=this.HandleOnMouseLeave.bind(this)}HandleOnMouseMove(e){var buttons=QuickBits.toBitArr(e.buttons);this.leftMousePressed=buttons[0],this.rightMousePressed=buttons[1],this.mousePrevPos={x:this.mousePos.x,y:this.mousePos.y},this.mousePos={x:e.clientX,y:e.clientY},(this.leftMousePressed||this.rightMousePressed)&&this.brushStroke(this.mousePos,this.mousePrevPos)}HandleOnMouseDown(e){e=QuickBits.toBitArr(e.buttons);this.leftMousePressed=e[0],this.rightMousePressed=e[1],this.brushStroke(this.mousePrevPos,this.mousePos)}HandleOnMouseUp(e){e=QuickBits.toBitArr(e.buttons);this.leftMousePressed=e[0],this.rightMousePressed=e[1]}HandleOnMouseEnter(e){var buttons=QuickBits.toBitArr(e.buttons);this.leftMousePressed=buttons[0],this.rightMousePressed=buttons[1],(this.leftMousePressed||this.rightMousePressed)&&(this.mousePos={x:e.clientX,y:e.clientY},this.brushStroke(this.mousePos,this.mousePos))}HandleOnMouseLeave(e){(this.leftMousePressed||this.rightMousePressed)&&this.brushStroke(this.mousePos,{x:e.clientX,y:e.clientY}),this.leftMousePressed=!1,this.rightMousePressed=!1}update(){(this.leftMousePressed||this.rightMousePressed)&&this.brushStroke(this.mousePos,this.mousePrevPos),this.mousePrevPos=JSON.parse(JSON.stringify(this.mousePos));let inUpdate=!1;for(const tile of this.tiles)inUpdate|=tile.inUpdate;if(!inUpdate&&!this.pauseState){var timeNow=performance.now(),lastFrameTime=timeNow-this.physicsStartTime;this.lastFramesTimes.push(lastFrameTime),100<this.lastFramesTimes.length&&this.lastFramesTimes.shift(),this.physicsStartTime=timeNow;for(const tile of this.tiles)tile.update()}}async save(){this.pauseState=!0;var image=await this.renderImage(),image=URL.createObjectURL(image);const link=document.createElement("a");link.href=image,link.download=Random.string(10)+".png",document.body.appendChild(link),link.click(),document.body.removeChild(link)}async renderImage(){const offscreen=new OffscreenCanvas(this.width,this.height),ctx=offscreen.getContext("2d",{alpha:!1});let imagedata=ctx.createImageData(this.width,this.height);for(let y=0;y<this.height;y++)for(let x=0;x<this.width;x++){var pixelIndex=this.pixelCoordsToPixelIndex(x,y),imageIndex=4*(x+y*this.width),pixelIndex=Colors[this.grid[pixelIndex]];imagedata.data[imageIndex]=pixelIndex[0],imagedata.data[1+imageIndex]=pixelIndex[1],imagedata.data[2+imageIndex]=pixelIndex[2],imagedata.data[3+imageIndex]=255}ctx.putImageData(imagedata,0,0);const imageBlob=await offscreen.convertToBlob();var imageArrBuffer=await imageBlob.arrayBuffer(),data={width:this.width,height:this.height,grid:this.grid.join(",")},imageArrBuffer=Buffer.from(imageArrBuffer),headerBuffer=Buffer.from("lugui-pixels-data"),data=Buffer.from(JSON.stringify(data)),imageArrBuffer=Buffer.concat([imageArrBuffer,headerBuffer,data]);return new Blob([imageArrBuffer],{type:"image/png"})}async loadFile(file){this.pauseState=!0;const reader=new FileReader,fileContent=await new Promise((resolve,reject)=>{reader.onload=e=>{resolve(e.target.result)},reader.onerror=e=>{reject(e)},reader.readAsText(file)});var findStr=Buffer.from("lugui-pixels-data");const index=fileContent.indexOf(findStr);if(-1===index)console.error("Invalid file.");else{const data=JSON.parse(fileContent.substring(index+findStr.length));var fileWidth=data.width,gridData=(data.height,data.grid.split(",")),maxWidth=Math.min(this.width,data.width),maxHeight=Math.min(this.height,data.height);this.clear();for(let x=0;x<maxWidth;x++)for(let y=0;y<maxHeight;y++){const index=this.pixelCoordsToPixelIndex(x,y);var filePixelIndex=4*(x+y*fileWidth);for(let i=0;i<4;i++)this.grid[index+i]=parseInt(gridData[filePixelIndex+i])}console.log(this.grid.join(" "))}}brushStroke(startPos,endPos){if(startPos.x===endPos.x&&startPos.y===endPos.y)this.paintPixels(this.getPixelsInRadius(endPos,this.brushSize));else{startPos=this.traceLine(startPos,endPos);if(this.brushSize<=0)this.paintPixels(startPos);else for(const pixel of startPos)this.paintPixels(this.getPixelsInRadius(pixel,this.brushSize))}}paintPixels(effectedPixels){var brush0ElementState=InitialState[this.brush0],brush1ElementState=InitialState[this.brush1];for(const pixel of effectedPixels)if(!(pixel.x<0||pixel.x>=this.width||pixel.y<0||pixel.y>=this.height)){var index=this.pixelCoordsToPixelIndex(pixel.x,pixel.y);let elState;elState=this.leftMousePressed&&this.rightMousePressed?.5<Math.random()?brush0ElementState:brush1ElementState:this.leftMousePressed?brush0ElementState:brush1ElementState;for(let i=0;i<4;i++)this.grid[index+i]!==Particles.Air&&elState[0]!==Particles.Air&&elState[0]!==Particles.Void||(this.grid[index+i]=elState[i])}}traceLine(startPos,endPos){const points=[];var dx=endPos.x-startPos.x,endPos=endPos.y-startPos.y,steps=Math.max(Math.abs(dx),Math.abs(endPos)),xInc=dx/steps,yInc=endPos/steps;let x=startPos.x,y=startPos.y;for(let i=0;i<steps;i++)points.push({x:Math.floor(x),y:Math.floor(y)}),x+=xInc,y+=yInc;return points}getPixelsInRadius(pixel,radius){const pixels=[];for(let x=pixel.x-radius;x<=pixel.x+radius;x++)for(let y=pixel.y-radius;y<=pixel.y+radius;y++)Math.sqrt(Math.pow(x-pixel.x,2)+Math.pow(y-pixel.y,2))<=radius&&pixels.push({x:x,y:y});return pixels}getPixelsInSquare(pixel,radius){const pixels=[];for(let x=pixel.x-radius;x<=pixel.x+radius;x++)for(let y=pixel.y-radius;y<=pixel.y+radius;y++)pixels.push({x:x,y:y});return pixels}setBrushParticle(brushId,particleId){switch(brushId){case 0:this.brush0=particleId;break;case 1:this.brush1=particleId}}getBrushParticleId(brushId){return 0==brushId?this.brush0:this.brush1}getBrushParticleName(brushId){return 0==brushId?Names[this.brush0]:Names[this.brush1]}getBrushSize(){return this.brushSize}setBrushSize(size){this.brushSize=15<size?15:size,this.brushSize=this.brushSize<0?0:this.brushSize}pixelCoordsToPixelIndex(x,y){return 4*(x+y*this.width)}pixelCoordsToTileIndex(x,y){return this.tiles.findIndex(tile=>tile.startX<=x&&tile.endX>=x&&tile.startY<=y&&tile.endY>=y)}getPhysicsFPS(){let sum=0;for(const time of this.lastFramesTimes)sum+=time;var fps=1e3/(sum/this.lastFramesTimes.length);return isNaN(fps)?0:fps}getPauseState(){return this.pauseState}togglePauseState(){this.pauseState=!this.pauseState}clear(){for(let i=0;i<this.grid.length;i++)this.grid[i]=0}terminate(){for(const tile of this.tiles)tile.terminate()}getParticleIdUnderMouse(){var index=this.pixelCoordsToPixelIndex(this.mousePos.x,this.mousePos.y);return index<0||index>=this.grid.length||void 0===this.grid[index]?Particles.Air:this.grid[index]}getCursosPos(){return this.mousePos}}}.call(this)}.call(this,require("buffer").Buffer)},{"./Particles/Particles":4,"./Tile":6,"./Utils/QuickBits":7,"./Utils/Random":8,buffer:2}],6:[function(require,module,exports){module.exports=class{inUpdate=!1;worker=null;tileIndex=-1;startX=0;startY=0;endX=0;endY=0;constructor(tileIndex,canvas,sharedBuffer,startX,startY,endX,endY,pixelDataSize,width,height){canvas=canvas.transferControlToOffscreen();this.tileIndex=tileIndex,this.startX=startX,this.startY=startY,this.endX=endX,this.endY=endY,this.worker=new Worker("pixelWorker.js"),this.worker.postMessage({type:"init",data:{canvas:canvas,sharedBuffer:sharedBuffer,startX:startX,startY:startY,endX:endX,endY:endY,pixelDataSize:pixelDataSize,screenWidth:width,screenHeight:height}},[canvas]),this.worker.onmessage=this.handleWorkerMessage.bind(this)}update(){this.inUpdate||(this.inUpdate=!0,this.worker.postMessage({type:"doPhysics"}))}handleWorkerMessage(e){var{type:e,data}=e.data;switch(e){case"debug":console.log(data);break;case"donePhysics":this.inUpdate=!1}}terminate(){this.worker.terminate()}}},{}],7:[function(require,module,exports){module.exports=class{static toBitArr(intVal){for(var bitArr=[],i=0;i<32;i++)bitArr.push(1&intVal),intVal>>=1;return bitArr}static Int16ToUInt8Arr(intVal){var arr=[0,0];return arr[0]=intVal>>8,arr[1]=255&intVal,arr}static UInt8ToInt16(a,b){return a<<8|b}}},{}],8:[function(require,module,exports){class Random{static int(min,max){return Math.floor(Math.random()*(max-min+1))+min}static getRandomRGB(){return[Random.int(0,255),Random.int(0,255),Random.int(0,255)]}static direction(){return.5<Math.random()?1:-1}static float(min,max){return Math.random()*(max-min)+min}static number(){return Math.random()}static string(size){let text="";var possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<size;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}}module.exports=Random},{}],9:[function(require,module,exports){if("undefined"==typeof SharedArrayBuffer||!HTMLCanvasElement.prototype.transferControlToOffscreen)throw alert("This page cannot run on modern browsers."),new Error("Unsupported browser");const{Names,Colors,Particles}=require("./Particles/Particles"),Sandbox=require("./Sandbox"),sandboxArea=document.getElementById("sandboxArea"),menuArea=document.getElementById("menu"),coords=document.getElementById("coords"),fps=document.getElementById("fps"),pause=document.getElementById("pause"),brush=document.getElementById("brushTool"),brushMinus=document.getElementById("brushMinus"),brushPlus=document.getElementById("brushPlus"),clear=document.getElementById("clear"),elements=document.getElementById("elements"),particleName=document.getElementById("particleName"),brush0=document.getElementById("brush0"),brush1=document.getElementById("brush1"),save=document.getElementById("save");var require=sandboxArea.offsetHeight,columns=sandboxArea.offsetWidth,columns=Math.floor(columns/400),require=Math.ceil(require/1400);let sandbox=new Sandbox(sandboxArea,[columns,require]);window.addEventListener("resize",()=>{document.location.reload()}),pause.addEventListener("click",()=>{sandbox.togglePauseState()}),document.addEventListener("keydown",event=>{"Space"==event.code&&sandbox.togglePauseState()}),sandboxArea.addEventListener("wheel",event=>{var currentBrushSize=sandbox.brushSize,event=0<event.deltaY?currentBrushSize-1:currentBrushSize+1;sandbox.setBrushSize(event)}),brushMinus.addEventListener("click",()=>{var newBrushSize=sandbox.brushSize-1;sandbox.setBrushSize(newBrushSize)}),brushPlus.addEventListener("click",()=>{var newBrushSize=sandbox.brushSize+1;sandbox.setBrushSize(newBrushSize)}),clear.addEventListener("click",()=>{sandbox.clear()});for(let i=0;i<Names.length;i++)if(!Particles.isHidden(i)){const name=Names[i];var color=Colors[i];const element=document.createElement("div");element.setAttribute("id","el-"+name),element.classList.add("element"),sandbox.getBrushParticleId()===i?element.classList.add("selected"):element.classList.add("unSelected"),element.textContent=name,element.style.color=`rgb(${color[0]}, ${color[1]}, ${color[2]})`,elements.appendChild(element),element.onclick=e=>{element.classList.add("selected"),element.classList.remove("unSelected"),sandbox.setBrushParticle(0,Particles.getId(name))},element.oncontextmenu=e=>{element.classList.add("selected"),element.classList.remove("unSelected"),sandbox.setBrushParticle(1,Particles.getId(name)),e.preventDefault()}}function handleDrag(event){return event.preventDefault(),event.stopPropagation(),!1}async function handleDrop(e){if(e.preventDefault(),e.dataTransfer.items)for(let i=0;i<e.dataTransfer.items.length;i++){var file;"file"===e.dataTransfer.items[i].kind&&(file=e.dataTransfer.items[i].getAsFile(),await sandbox.loadFile(file))}}save.onclick=async()=>{await sandbox.save()},sandboxArea.ondragover=handleDrag,menuArea.ondragover=handleDrag,sandboxArea.ondrop=handleDrop,menuArea.ondrop=handleDrop,window.requestAnimationFrame(function update(){coords.textContent=sandbox.mousePos.x+" "+sandbox.mousePos.y,brush.textContent="Brush:"+sandbox.brushSize.toString().padStart(2,"0");var particleId=sandbox.getParticleIdUnderMouse(),particleId=(particleName.textContent=""+Names[particleId],particleName.style.color=`rgb(${Colors[particleId][0]}, ${Colors[particleId][1]}, ${Colors[particleId][2]})`,document.getElementById("el-"+Names[sandbox.getBrushParticleId(0)])),selectedParticle1=document.getElementById("el-"+Names[sandbox.getBrushParticleId(1)]);brush0.style.left=particleId.offsetLeft-6+"px",brush0.style.top=particleId.offsetTop+"px",brush1.style.left=selectedParticle1.offsetLeft-6+"px",brush1.style.top=selectedParticle1.offsetTop+"px",fps.textContent="FPS:"+Math.floor(Math.round(sandbox.getPhysicsFPS())),window.requestAnimationFrame(update)}),setInterval(()=>{sandbox.getPhysicsFPS()<65&&sandbox.update()},1),setInterval(()=>{sandbox.update()},20),setInterval(async()=>{pause.textContent=sandbox.getPauseState()?"Play":"Pause",fps.textContent=""+(0==sandbox.getPauseState()?Math.floor(sandbox.getPhysicsFPS()):"00")},100)},{"./Particles/Particles":4,"./Sandbox":5}]},{},[9]);
