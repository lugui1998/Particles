!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){class Particles{static Void=0;static Sand=1}const Names=[],Colors=(Names[Particles.Void]="Void",Names[Particles.Sand]="Sand",[]);Colors[Particles.Void]=[0,0,0],Colors[Particles.Sand]=[242,189,107],module.exports={Particles:Particles,Names:Names,Colors:Colors}},{}],2:[function(require,module,exports){const{Colors,Particles}=require("./Particles/Particles");let pixelData,canvas,startX,startY,endX,endY,pixelDataSize,screenWidth,screenHeight,width,height;const subTileSIze=100;let subTiles=[],tileCheckIndex=0;function render(){let imagedata=ctx.createImageData(width,height);for(let y=startY;y<endY;y++)for(let x=startX;x<endX;x++){var pixeldData=desserialziePixel(coordsToIndex(x,y)),imageIndex=4*(x-startX+(y-startY)*width),pixeldData=Colors[pixeldData.type];imagedata.data[imageIndex]=pixeldData[0],imagedata.data[1+imageIndex]=pixeldData[1],imagedata.data[2+imageIndex]=pixeldData[2],imagedata.data[3+imageIndex]=255}ctx.putImageData(imagedata,0,0),requestAnimationFrame(render)}function coordsToSubTileIndex(x,y){return subTiles.findIndex(subtile=>subtile.startX<=x&&subtile.endX>x&&subtile.startY<=y&&subtile.endY>y)}function coordsToIndex(x,y){return(x+y*screenWidth)*pixelDataSize}function desserialziePixel(index){index=pixelData.slice(index,index+pixelDataSize);return{type:index[0],info1:index[1],info2:index[2],info3:index[3]}}function isEmpty(x,y){if(function(x,y){return 0<=x&&x<screenWidth&&0<=y&&y<screenHeight}(x,y))return desserialziePixel(coordsToIndex(x,y)).type===Particles.Void}onmessage=function(e){var message=e.data;switch(message.type){case"init":!function(data){pixelData=new Int16Array(data.sharedBuffer),canvas=data.canvas,startX=data.startX,startY=data.startY,endX=data.endX,endY=data.endY,width=endX-startX,height=endY-startY,pixelDataSize=data.pixelDataSize,screenWidth=data.screenWidth,screenHeight=data.screenHeight;for(let y=startY;y<endY;y+=subTileSIze)for(let x=startX;x<endX;x+=subTileSIze)subTiles.push({startX:x,startY:y,endX:Math.min(x+subTileSIze,endX),endY:Math.min(y+subTileSIze,endY),active:!1});ctx=canvas.getContext("2d",{alpha:!1}),requestAnimationFrame(render)}(message.data);break;case"doPhysics":!function(){let i=0;for(;++tileCheckIndex>=subTiles.length&&(tileCheckIndex=0),subTiles[tileCheckIndex].active=!function(index){let differentMaterial=!1,lastMaterial=null;var subtile=subTiles[index];for(let y=subtile.startY;y<subtile.endY;y++)for(let x=subtile.startX;x<subtile.endX;x++){var pixelIndex=coordsToIndex(x,y);if(differentMaterial|=null!==lastMaterial&&lastMaterial!=pixelData[pixelIndex])return;lastMaterial=pixelData[pixelIndex]}return 1}(tileCheckIndex),++i<5;);for(let subtileIndex=subTiles.length-1;0<=subtileIndex;subtileIndex--){var subtile=subTiles[subtileIndex];if(subtile.active)for(let y=subtile.endY-1;y>=subtile.startY;y--)for(let x=subtile.startX;x<subtile.endX;x++)!function(x,y){var index=coordsToIndex(x,y),data=desserialziePixel(index);switch(data.type){case Particles.Void:break;case Particles.Sand:!function(x,y,index,data){let kinecticEnergy=data.info1,stepX=x,stepY=y,setpIndex=index,setepData=data,i=0,targetX=x,targetY=y,targetIndex,targetData=null;for(;targetY++,targetIndex=coordsToIndex(targetX,targetY),targetData=desserialziePixel(targetIndex),isEmpty(targetX,targetY)&&(stepX=targetX,stepY=targetY,setpIndex=targetIndex,++i<=4););kinecticEnergy=kinecticEnergy<2?kinecticEnergy+1:2;var randomDirection=Math.floor(3*Math.random())-1;let sideMoves=0;for(;++sideMoves<=kinecticEnergy&&(targetX+=randomDirection,targetIndex=coordsToIndex(targetX,targetY),targetData=desserialziePixel(targetIndex),kinecticEnergy--,isEmpty(targetX,targetY));)stepX=targetX,stepY=targetY,setpIndex=targetIndex;setepData.info1=kinecticEnergy,function(index,data){let i=0;for(;pixelData[index]=data[0],++i<pixelDataSize;);}(setpIndex,function(pixel){return[pixel.type,pixel.info1,pixel.info2,pixel.info3]}(setepData)),stepX===x&&stepY===y||function(index){pixelData[index]=Particles.Void;let i=1;for(;pixelData[index]=0,++i<pixelDataSize;);}(index);data=coordsToSubTileIndex(stepX,stepY);void 0!==data&&-1!==data&&(subTiles[data].active=!0)}(x,y,index,data)}}(x,y)}postMessage({type:"donePhysics"})}();break;case"updatePixels":!function(pixelArr){for(let i=0;i<pixelArr.length;i++){var subtileIndex=coordsToSubTileIndex(pixelArr[i][0],pixelArr[i][1]);void 0!==subtileIndex&&-1!==subtileIndex&&(subTiles[subtileIndex].active=!0)}}(message.data)}}},{"./Particles/Particles":1}]},{},[2]);
